# 泛型(generics)

[TOC]

以下文章翻译自golang官方教程[教程: 泛型入门](https://go.dev/doc/tutorial/generics)。

这个教程介绍了go的泛型基础。通过泛型，你可以声明和使用函数或类型，这些函数或类型可以被调用代码提供的任何一组类型所使用。

在本教程中，你将声明两个简单的非泛型函数，然后再单个泛型函数中捕获相同的逻辑。

你将通过以下部分进行：

1. 为你的代码创建一个文件夹。
2. 添加非泛型函数。
3. 添加一个泛型函数来处理多种类型。
4. 调用泛型函数时移除类型声明。
5. 声明类型约束。

注意：有关其它教程，请参见[教程](https://go.dev/doc/tutorial/index.html)

注意：如果你愿意，你可以使用 Go playground 在 "Go dev branch"模式下编辑和运行你的程序。

## 前提条件

- 安装 Go 1.13 或以上。有关安装说明，请参阅[安装 Go](https://go.dev/doc/install)
- 编辑代码的工具。你拥有的任何文本编辑器都能工作。
- 一个命令行。Go可以在 Linux 和 Mac 上使用任何终端，也可以在 Windows 的 PowerShell 和 cmd 上运行。

## 为你的代码创建一个文件夹

要开始，为要编写的代码创建一个文件夹。

1. 打开一个命令行工具并切换到主目录

   在 Linux 或 Mac：

   ```shell
   $ cd
   ```

   在 Windows：

   ```powershell
   C:\> cd %HOMEPATH%
   ```

   本教程的其余部分将使用 $ 作为提示。你使用的命令也适用于 Windows。

2. 在命令行工具下，创建一个名为 generics 的目录。

   ```shell
   $ mkdir generics
   $ cd generics
   ```

3. 创建一个模块来保存代码。

   运行 `go mod init` 命令，为其指定新代码的模块路径。

   ```shell
   $ go mod init example/generics
   go: creating new go.mod: module example/generics
   ```

   注意：在生成环境代码中，你需要指定更符合你需求的具体模块路径。有关更多信息，请参见[管理依赖项](https://go.dev/doc/modules/managing-dependencies)

接下来，你将添加一些简单的代码来处理map。

## 添加非泛型函数

在这一步中，你将添加两个函数，每个函数将一个map的值相加并返回总数。

声明两个函数而不是一个，因为你使用的时两种不同类型的map：一种存储的`int64`值，一种存储`float64`值。

### 写代码

1. 使用你的文本编辑器，创建一个名为main.go的文件。你将在该文件中编写Go代码。

2. 进入 main.go，在文件的最顶端，粘贴以下包声明。

   ```go
   package main
   ```

   一个单独的程序（与库相反）始终位于`main`包中。

3. 在包声明下面，粘贴以下两个函数声明。

   ```go
   // SumInts 将 m 的值相加
   func SumInts(m map[string]int64) int64 {
       var s int64
       for _, v := range m {
           s += v
       }
       return s
   }
   // SumFloats 将 m 的值相加
   func SumFloats(m map[string]float64) float64 {
       var s float64
       for _, v := range m {
           s += v
       }
       return s
   }
   ```

   在此代码中，你：

    - 声明两个将 map 的值相加并返回总和。
      	- `SumFloats`取map中的`string`映射`float64`的值
      	- `SumInts`取map中的`string`映射`int64`的值

4. 在 main.go 的顶端，在包声明的下面，粘贴以下 `main` 函数取初始化两个 maps 并使用它们作为参数去调用你先前步骤写的函数。

   ```go
   func main() {
       // Initialize a map for the integer values
       ints := map[string]int64{
           "first":  34,
           "second": 12,
       }
   
       // Initialize a map for the float values
       floats := map[string]float64{
           "first":  35.98,
           "second": 26.99,
       }
   
       fmt.Printf("Non-Generic Sums: %v and %v\n",
           SumInts(ints),
           SumFloats(floats))
   }
   ```

   在此代码中，你：

   - 初始化 `float64`值的map和`int64`值的map，每个都有两个条目。
   - 调用前面声明的两个函数来查找每个映射值的总和。
   - 打印结果

5. 接近 main.go 的顶端，在包声明的下面，导入你需要的包，以支持你刚刚编写的代码。

   第一行代码应该如下所示：

   ```go
   package main
   
   import "fmt"
   ```

6. Save main.go

### 运行代码

从包含 main.go 的目录命令行去运行代码。

```go
$ go run .
Non-Generic Sums: 46 and 62.97
```

使用泛型，你可以在这里编写一个函数，而不是两个。接下来，你将为包含整数值和浮点值的map添加一个通用函数。

## 添加一个泛型函数来处理多种类型

在本节中，你将添加一个泛型函数，该函数可以接受包含整数或浮点值的map，从而有效地用一个函数替换你编写的两个函数。



















